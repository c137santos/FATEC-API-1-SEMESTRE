<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gerenciamento de Turma</title>
    <link rel="stylesheet" href="../front/style/gerenciamento_turmas.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/light.min.css">
    <link rel="stylesheet" href="style/custom.css">
  </head>
  </head>
  <body>
    <h1 class="title">Gerenciamento de Turmas:</h1>
    <div class="turma-container">
      <div class="flex-warp-container">
        <!-- As turmas serão adicionadas automaticamente aqui -->
      </div>
    </div>
    <!-- Modal de Criação de Turma -->
    <div id="myModal" class="modal">
      <div class="modal-content">
          <span class="close" onclick="closeModal()">&times;</span>
          <h2>Criar Turma</h2>
          
          <!-- Formulário para criar uma turma -->
          <div class="form-container">
            <div class="data-content">
              <label for="turmaNome">Nome da turma:</label>
              <input type="text" id="turmaNome" class="input-field" />
  
              <label for="professor">Professor responsável:</label>
              <input type="text" id="professor" class="input-field" />
  
              <label for="dataInicio">Data de início:</label>
              <input type="text" id="dataInicio" class="input-field" />
            </div>
              <h3>Grupos:</h3>
              <div class="mostra-turmas"></div>
              <ul id="gruposSemTurmaList">
                  <!-- Grupos serão adicionados automaticamente aqui -->
              </ul>
          </div>
      </div>
  </div>


    <button class="add-turma-button">Adicionar Turma</button>
    <script>
      // Função que lida com o evento "DOMContentLoaded" e configura os ouvintes de eventos
      document.addEventListener("DOMContentLoaded", function () {
        const turmaContainer = document.querySelector(".turma-container");

        // Chama a função para buscar turmas
        GetTurmas();

        // Verifica se ocorreu um clique em algum lugar dentro do elemento turmaContainer
        turmaContainer.addEventListener("click", function (event) {
          const target = event.target;

          // Verifica se o clique ocorreu no turma-square ou no trash-icon
          const turmaSquare = target.closest(".turma-square");
          const trashIcon = target.closest(".trash-icon")
          if (target.classList.contains("trash-icon")) {
            console.log("Deletar turma", trashIcon.id + "?");
            deletarTurmaSelecionada(trashIcon.id)
          } else {
            console.log("ID da Turma Clicada:", turmaSquare.id);

            coletaInfoTurmaSelecionada(turmaSquare.id);
          }

        });
      });

      async function GetTurmas() {
        try {
          const response = await fetch(
            "http://127.0.0.1:8080/api/v1/turmas/get" //
          );
          const turma_Data = await response.json();
          console.log(turma_Data);

          // Chama a função para exibir as turmas
          exibirTurmas(turma_Data);
        } catch (error) {
          console.error("Erro ao buscar dados da API -> ", error);
          return null;
        }
      }

      // Função para exibir as turmas no DOM
      function exibirTurmas(Turmadata) {
        const container = document.querySelector(".flex-warp-container");
        // Itera sobre os objetos do JSON e cria elementos HTML para cada turma
        for (const turmaId in Turmadata) {
          if (Turmadata.hasOwnProperty(turmaId)) {
            const turma = Turmadata[turmaId];

            // Cria um elemento div para representar uma turma
            const turmaSquare = document.createElement("div");
            turmaSquare.className = "turma-square";
            turmaSquare.id = `${turmaId}`; // Adiciona o ID da turma ao turmaSquare

            // Cria elementos de parágrafo para o nome da turma e nome do professor
            const nomeTurma = document.createElement("p");
            nomeTurma.textContent = `Nome da Turma: ${turma.nome}`;

            const nomeProfessor = document.createElement("p");
            nomeProfessor.textContent = `Professor: ${turma.professor}`;

            // Adiciona os parágrafos ao turmaSquare
            turmaSquare.appendChild(nomeTurma);
            turmaSquare.appendChild(nomeProfessor);

            // Cria um ícone de lixeira para deletar a turma
            const imagemIcon = document.createElement("img");
            imagemIcon.src = "../front/icon/trash-icon.svg"; // Substitua pelo caminho correto da imagem
            imagemIcon.alt = "Ícone";
            imagemIcon.className = "trash-icon";
            imagemIcon.width = 20;
            imagemIcon.height = 20;
            imagemIcon.id = `${turmaId}`; // Adiciona o ID da turma ao ícone de deletar

            // Adiciona o ícone ao turmaSquare
            turmaSquare.appendChild(imagemIcon);

            // Adiciona o turmaSquare ao container
            container.appendChild(turmaSquare);
          }
        }
      }

      // Função assíncrona para coletar informações da turma selecionada
      async function coletaInfoTurmaSelecionada(turmaId) {
        try {
          const response = await fetch(
            `http://127.0.0.1:8080/api/v1/get_grupos_alunos/${turmaId}/get`
          );

          if (!response.ok) {
            throw new Error(`Erro na solicitação: ${response.statusText}`);
          }

          const teste = await response.json();
          console.log(teste);
        } catch (error) {
          console.error(error);
        }
      }

      async function deletarTurmaSelecionada(turmaId){
        try {
          const response = await fetch (
            `http://127.0.0.1:8080/api/v1/delete_turma/${turmaId}/delete`
          )

        } catch (error) {
          console.error(error);
        }
        
      }

      // Função para mostrar o modal
      function showModal() {
        var modal = document.getElementById("myModal");
        modal.style.display = "block";
        // Chame a função para buscar os grupos sem turmas e adicione-os à lista no modal
        fetch("http://127.0.0.1:8080/api/v1/grupo_semTurma/get")
          .then((response) => response.json())
          .then((data) => {
            var gruposSemTurmaList =
              document.getElementById("gruposSemTurmaList");

            // Limpe a lista existente (caso haja)
            gruposSemTurmaList.innerHTML = "";

            for (const grupo in data.grupos_data) {
              if (data.grupos_data.hasOwnProperty(grupo)) {
                const grupoNome = data.grupos_data[grupo].nome;

                    // Criar um checkbox para cada grupo
                    const checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.id = grupo; // ID único para cada checkbox
                    checkbox.classList = "checkbox";

                    // Criar uma label para o checkbox
                    const label = document.createElement("label");
                    label.setAttribute("for", checkbox.id);
                    label.textContent = grupoNome;

                    // Adicionar o checkbox e a label à lista
                    const listItem = document.createElement("li");
                    listItem.appendChild(checkbox);
                    listItem.appendChild(label);
                    gruposSemTurmaList.appendChild(listItem);
                }
            }
        })
          .catch((error) => {
            console.error("Erro ao buscar grupos sem turmas: " + error);
          });
      }

      // Adicionar um evento de clique ao botão "Adicionar Turma" para mostrar o modal
      var addTurmaButton = document.querySelector(".add-turma-button");
      addTurmaButton.addEventListener("click", showModal);

      // Função para fechar o modal
      function closeModal() {
        var modal = document.getElementById("myModal");
        modal.style.display = "none";
      }
    </script>
  </body>
</html>
